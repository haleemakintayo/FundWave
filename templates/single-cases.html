{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}

<body>

    <!-- GoUp START -->
    <button id="topBtn"><i class="fas fa-arrow-up"></i></button>
    <!-- GoUp END -->




    <!--  Banner START -->

    <div class="banner">
        <div class="banner__overlay">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center text-lg-start">
                        <h1 class="global__title global__title-dark text-capitalize">single Case</h1>
                        <ul class="banner__ul">
                            <li class="banner__ul-list p-0">
                                <a class="banner__ul-link" href="{% url 'home' %}">
                                    home
                                </a>
                            </li>
                            <li class="banner__ul-list">
                                single Case
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="banner__element d-none d-lg-block">
                    <img src="{% static '/img/element-3.svg' %}" alt="image">
                </div>
                <div class="banner__polygon d-none d-lg-block">
                    <img src="{% static '/img/polygon.svg' %}" alt="image">
                </div>
            </div>
        </div>
    </div>

    <!--  Banner END -->

    <!-- Education START -->
    <div class="education global__py pt-0">
        <div class="container p-sm-0">
            <div class="row">
                <div class="col-12 col-lg-8">
                    <div class="col-md-10">
                        <h2 class="global__heading mb-0">{{ case.title }}</h2>
                        <div class="education__card-img">
                            <img class="img-fluid w-100" src="{{ case.image.url }}" alt="{{ case.title }}">
                            <h4 class="education__card-tag">{{ case.category }}</h4>
                        </div>
                        <div class="col-md-7">
                            <div class="cases__card-range">
                                <p class="global__desc m-0">Founded: {{ case.progress_percentage|floatformat:2 }}%</p>
                                <div class="progress cases__card-progress">
                                    <div class="progress-bar cases__card-progress--bar" role="progressbar"
                                        style="width: {{ case.progress_percentage }}%" aria-valuenow="25"
                                        aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="cases__card-range--bottom">
                                    <div class="d-flex align-items-center cases__card-range--bottom---m gap-2">
                                        <img class="cases__card-range--dollar" src="{% static 'img/box.svg' %}"
                                            alt="icon">
                                        <span class="cases__card-range--price">
                                            Raised: ₦{{ case.raised_amount|intcomma }}
                                        </span>
                                    </div>
                                    <div class="d-flex align-items-center gap-2">
                                        <img class="cases__card-range--dollar" src="{% static 'img/dollar-s.svg' %}"
                                            alt="icon">
                                        <span class="cases__card-range--price">Goal: ₦{{ case.goal_amount|intcomma }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card education__card">
                        <!-- <div class="education__card-img">
                                <img class="img-fluid w-100" src="{% static '/img/single-case.png' %}" alt="image">
                                <h4 class="education__card-tag">Education</h4>
                            </div> -->
                        <div class="">
                            <p class="education__para education__para-mt">
                                {{ case.description }}
                            </p>

                        </div>
                    </div>

                    <div class="col-lg-12 col-xl-10">
                        <h1
                            style="text-align: center; font-family: Arial, sans-serif; color: #333; margin-bottom: 20px;">
                            Make a Payment</h1>
                        <form method="POST"
                            style="max-width: 500px; margin: 0 auto; background: #f7f7f7; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); font-family: Arial, sans-serif;">
                            {% csrf_token %}

                            <label for="connection_mode"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">Mode:</label>
                            <select name="connection_mode"
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                                <option value="Test">Test</option>
                                <option value="Live">Live</option>
                            </select>

                            <label for="checkout_amount"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">Amount:</label>
                            <input type="number" name="checkout_amount" required
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">

                            <label for="currency_code"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">Currency:</label>
                            <select name="currency_code"
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                                <option value="NGN">NGN</option>
                                <option value="USD">USD</option>
                            </select>

                            <label for="email_address"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">Email:</label>
                            <input type="email" name="email_address" required
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">

                            <label for="first_name"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">First
                                Name:</label>
                            <input type="text" name="first_name" required
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">

                            <label for="last_name"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">Last
                                Name:</label>
                            <input type="text" name="last_name" required
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">

                            <label for="phone_number"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">Phone
                                Number:</label>
                            <input type="tel" name="phone_number" required
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">

                            <label for="transaction_reference"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">Transaction
                                Reference:</label>
                            <input type="text" name="transaction_reference" value="txn-{{ uuid.uuid4 }}" required
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">

                            <!-- Optional fields -->
                            <label for="pnr"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">PNR:</label>
                            <input type="text" name="pnr"
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">

                            <label for="ticket_number"
                                style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">Ticket
                                Number:</label>
                            <input type="text" name="ticket_number"
                                style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">

                            <button type="submit"
                                style="width: 100%; padding: 12px; background-color: green; color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.3s;">
                                Proceed to Pay
                            </button>
                    </div>

                </div>
                <!-- Right Sider_Bar -->
                <div class="col-12 col-sm-8 col-lg-4 mt-5 mt-lg-0">
                    <div class="education__search">
                        <h4 class="education__txt">search</h4>
                        <form action="#" method="POST" class="d-flex position-relative mt-3">
                            <input class="education__inp form-control" type="text" placeholder="Enter your email">
                            <button class="global__btn education__inp-btn"><i
                                    class="fa-solid fa-magnifying-glass"></i></button>
                        </form>
                    </div>
                    <div class="education__cases">
                        <h4 class="education__txt">recent cases</h4>
                        <div class="">
                            <ul class="education__cases-list">
                                <li>
                                    <a class="education__cases-list--img" href="">
                                        <img class="" src="{% static '/img/recent-img-1.png' %}" alt="image">
                                    </a>
                                    <div class="">
                                        <a href="" class="education__cases-list--link">Education
                                            program in
                                            Uganda</a>
                                        <p class="education__cases-list--date">November 09, 2024</p>
                                    </div>
                                </li>
                                <li>
                                    <a class="education__cases-list--img" href="">
                                        <img class="" src="{% static '/img/recent-img-2.png' %}" alt="image">
                                    </a>
                                    <div class="">
                                        <a href="" class="education__cases-list--link">African water
                                            crisis :
                                            Children
                                            and women</a>
                                        <p class="education__cases-list--date">November 10, 2024</p>
                                    </div>
                                </li>
                                <li>
                                    <a class="education__cases-list--img" href="">
                                        <img class="" src="{% static '/img/recent-img-3.png' %}" alt="image">
                                    </a>
                                    <div class="">
                                        <a href="" class="education__cases-list--link">Be kind for the
                                            poor
                                            people and
                                            the kids.</a>
                                        <p class="education__cases-list--date">November 15, 2024</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="education__cases">
                        <h4 class="education__txt">Categories</h4>
                        <div class="">
                            <ul class="education__cases-list">
                                <li class="education__cases-list--m">
                                    <a href="#" class="education__cases-list--link education__cases-list--tag">healthy
                                        food</a>
                                </li>
                                <li class="education__cases-list--m">
                                    <a href="#" class="education__cases-list--link education__cases-list--tag">Free
                                        Education</a>
                                </li>
                                <li class="education__cases-list--m">
                                    <a href="#" class="education__cases-list--link education__cases-list--tag">Sickle
                                        cell awareness</a>
                                </li>
                                <li class="education__cases-list--m">
                                    <a href="#" class="education__cases-list--link education__cases-list--tag">Medical
                                        Emergencies</a>
                                </li>
                                <li class="education__cases-list--m">
                                    <a href="#" class="education__cases-list--link education__cases-list--tag">School
                                        supplies</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Form -->
            <div class="row">

            </div>
        </div>
    </div>
    <!-- Education END  -->


    <!--  Cases START  -->

    <div class="cases global__py pt-0">
        <div class="container p-sm-0">
            <div class="row">
                <div class="col-12 col-md-9 col-lg-6 text-center m-auto" data-aos="fade-down" data-aos-duration="1000">
                    <h3 class="global__text">Our cases</h3>
                    <h2 class="global__heading">
                        Popular causes what you should know
                    </h2>
                </div>
            </div>
            <div class="row">
                <div class="cases__slider3 position-relative">
                    <div class="cases__slider3-slider">
                        {% for case in cases %}
                        <div class="card cases__card">
                            <div class="cases__card-img">
                                <a href="">
                                    {% if case.image %}
                                    <img class="img-fluid w-100" src="{{ case.image.url }}" alt="{{ case.title }}">
                                    {% else %}
                                    <img class="img-fluid w-100" src="{% static 'img/default.png' %}"
                                        alt="Default Image">
                                    {% endif %}
                                </a>
                                <h4 class="cases__card-tag">{{ case.category }}</h4>
                            </div>
                            <div class="card-body px-4">
                                <div class="d-flex">
                                    <img class="cases__card-i" src="{% static 'img/location.svg' %}"
                                        alt="Location Icon">
                                    <span class="cases__card-location">{{ case.location }}</span>
                                </div>
                                <div class="">
                                    <a href="" class="cases__card-title">{{ case.title }}</a>
                                </div>
                                <div class="cases__card-range">
                                    <p class="global__desc m-0">Foundred: {{ case.progress_percentage|floatformat:2 }}%
                                    </p>
                                    <div class="progress cases__card-progress">
                                        <div class="progress-bar cases__card-progress--bar" role="progressbar"
                                            style="width: {{ case.progress_percentage }}%"
                                            aria-valuenow="{{ case.progress_percentage }}" aria-valuemin="0"
                                            aria-valuemax="100">
                                        </div>
                                    </div>
                                    <div class="cases__card-range--bottom">
                                        <div class="d-flex align-items-center cases__card-range--bottom---m gap-2">
                                            <img class="cases__card-range--dollar" src="{% static 'img/box.svg' %}"
                                                alt="Raised Icon">
                                            <span class="cases__card-range--price">Raised: ₦{{
                                                case.raised_amount|floatformat:2 }}</span>
                                        </div>
                                        <div class="d-flex align-items-center gap-2">
                                            <img class="cases__card-range--dollar" src="{% static 'img/dollar-s.svg' %}"
                                                alt="Goal Icon">
                                            <span class="cases__card-range--price">Goal: ₦{{
                                                case.goal_amount|floatformat:2 }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>


        </div>
    </div>

    <!--  Cases END  -->


    <!--  Join_US START -->

    <div class="join">
        <div class="container p-sm-0">
            <div class="row">
                <div class="card join__card">
                    <img src="{% static '/img/BG-Element.png' %}" class="img-fluid join__card-img" alt="image">
                    <div class="card-img-overlay join__card-layer">
                        <div class="col-11 col-md-7">
                            <h3 class="join__text global__text">Become a volenteer</h3>
                            <h2 class="join__heading global__heading">Join Your hand with us for a better life and
                                future
                            </h2>
                            <button class="join__card-layer--btn global__btn">Discover More</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('donationForm');
            const donateButton = document.getElementById('donateButton');
            const buttonText = donateButton.querySelector('.button-text');
            const spinner = donateButton.querySelector('.spinner-border');

            // Previous custom amount handling code remains...

            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                // Validate required fields
                if (!validateForm()) {
                    return;
                }

                // Show loading state
                donateButton.disabled = true;
                buttonText.textContent = 'Processing...';
                spinner.classList.remove('d-none');

                try {
                    // Get form data
                    const formData = new FormData(form);

                    // Send the form data
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                        }
                    });

                    const data = await response.json();

                    if (response.ok) {
                        if (data.redirect_url) {
                            // If payment gateway redirect is needed
                            window.location.href = data.redirect_url;
                        } else if (data.success) {
                            // Show success message
                            showMessage('Thank you for your donation!', 'success');
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        } else {
                            showMessage(data.message || 'An error occurred. Please try again.', 'error');
                        }
                    } else {
                        throw new Error(data.message || 'Server error');
                    }
                } catch (error) {
                    showMessage('An error occurred. Please try again.', 'error');
                    console.error('Submission error:', error);
                } finally {
                    // Reset button state
                    donateButton.disabled = false;
                    buttonText.textContent = 'Donate Now';
                    spinner.classList.add('d-none');
                }
            });

            function validateForm() {
                let isValid = true;

                // Clear previous error messages
                clearErrors();

                // Validate amount
                const selectedAmount = form.querySelector('input[name="amount"]:checked');
                const customAmount = form.querySelector('input[name="custom_amount"]').value;

                if (!selectedAmount && !customAmount) {
                    showError('Please select or enter a donation amount');
                    isValid = false;
                }

                // Validate donation type
                const donationType = form.querySelector('input[name="donation_type"]:checked');
                if (!donationType) {
                    showError('Please select a donation type');
                    isValid = false;
                }

                // Validate required fields
                const requiredFields = ['first_name', 'last_name', 'email'];
                requiredFields.forEach(field => {
                    const input = form.querySelector(`input[name="${field}"]`);
                    if (!input.value.trim()) {
                        showError(`Please enter your ${field.replace('_', ' ')}`, field);
                        isValid = false;
                    }
                });

                // Validate email format
                const email = form.querySelector('input[name="email"]');
                if (email.value && !isValidEmail(email.value)) {
                    showError('Please enter a valid email address', 'email');
                    isValid = false;
                }

                return isValid;
            }

            function isValidEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }

            function showError(message, fieldName = null) {
                if (fieldName) {
                    const field = form.querySelector(`[name="${fieldName}"]`);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'invalid-feedback d-block';
                    errorDiv.textContent = message;
                    field.classList.add('is-invalid');
                    field.parentNode.appendChild(errorDiv);
                } else {
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-danger mt-3';
                    alertDiv.textContent = message;
                    form.insertBefore(alertDiv, form.firstChild);
                }
            }

            function clearErrors() {
                // Remove general error messages
                form.querySelectorAll('.alert').forEach(alert => alert.remove());

                // Remove field-specific error messages
                form.querySelectorAll('.invalid-feedback').forEach(feedback => feedback.remove());
                form.querySelectorAll('.is-invalid').forEach(field => field.classList.remove('is-invalid'));
            }

            function showMessage(message, type) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} mt-3`;
                alertDiv.textContent = message;
                form.insertBefore(alertDiv, form.firstChild);

                // Scroll to message
                alertDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    </script>

    <!--  Join_US END -->

    {% endblock content %}